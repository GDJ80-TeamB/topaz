<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.topaz.mapper.NoticeMapper">

	<!-- 분류 번호: #10 - 공지 사항 상세 페이지 -->
	<select id="selectNoticeDetail" parameterType="map" resultType="map">
		SELECT
			news_no newsNo, title, content, grade, category, 
			DATE_FORMAT(start_date, '%Y-%m-%d %H:%i:%s') startDate,
			DATE_FORMAT(end_date, '%Y-%m-%d %H:%i:%s') endDate,
			DATE_FORMAT(reg_time, '%Y-%m-%d %H:%i:%s') regTime, 
			DATE_FORMAT(mod_time, '%Y-%m-%d %H:%i:%s') modTime, 
			use_yn useYn
		FROM
			news_notice
		WHERE 	
			news_no = #{newsNo}
	
	</select>
	
	<!-- 분류 번호: #10 - 공지 사항 목록 페이지 - 페이징 -->
	<select id="noticeCnt" resultType="int">
		SELECT
			COUNT(*) cnt
		FROM
			news_notice
		WHERE
			use_yn = 'Y'
			AND grade IN (1,2)
			AND category IN (1,2,3)
			AND (views IS NULL);	 
	</select> 
	
	<!-- 분류 번호: #10 - 공지 사항 목록 페이지 - 리스트 -->
	<select id="selectNoticeList" parameterType="map" resultType="map">
		SELECT 
			rowNum no, news_no newsNo, title, content, grade, category, 
			DATE_FORMAT(start_date, '%Y-%m-%d %H:%i:%s') startDate, 
			DATE_FORMAT(end_date, '%Y-%m-%d %H:%i:%s') endDate, 
			DATE_FORMAT(reg_time, '%Y-%m-%d %H:%i:%s') regTime, 
			DATE_FORMAT(mod_time, '%Y-%m-%d %H:%i:%s') modTime, 
			use_yn useYn
		FROM (
		    SELECT *, ROW_NUMBER() OVER(ORDER BY news_no ASC) rowNum
		    FROM news_notice
		) rn
		<where>
			rn.use_yn = 'Y'
			AND (views IS NULL)
			AND grade IN (1,2)
			AND category IN (1,2,3)
			AND
			<if test="searchWord != null">
				title Like CONCAT('%', #{searchWord}, '%')
				OR content Like CONCAT('%', #{searchWord}, '%')
			</if>
		</where>
		ORDER BY 
			rowNum DESC
		LIMIT #{beginRow}, ${rowPerPage};
	</select>
</mapper>