<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.topaz.mapper.ApprovalMapper">

	<!-- 분류 번호: #11 - 전자결재 신청 페이지 :: 서명 등록 -->
	<update id="insertApprovalSign" parameterType="com.topaz.dto.Employee">
		UPDATE
			employee
		SET
			  sign_file = #{signFile}
			, mod_id = #{modId}
			, mod_time = NOW()
		WHERE
			emp_no = #{empNo}
	</update>
	
	
	<!-- 분류 번호: #11 - 전자결재 신청 페이지 :: 서명 파일 등록 -->
	<insert id="insertApprovalSignFile" parameterType="com.topaz.dto.UploadFile">
		INSERT INTO file_upload(
			  file_no
			, reference_no
			, original_file_name
			, file_name
			, file_size
			, file_type
			, reg_id
			, reg_time
			, mod_id
			, mod_time
			, use_yn
		)VALUES(
			  #{fileNo}
			, #{referenceNo}
			, #{OriginalFileName}
			, #{fileName}
			, #{fileSize}
			, #{fileType}
			, #{regId}
			, NOW()
			, #{modId}
			, NOW()
			, #{useYN}
		)
	</insert>
	
	
	<!-- 분류 번호: #11 - 전자결재 신청 페이지 :: 서명 파일 조회 -->
	<select id="selectEmpSign" parameterType="String" resultType="map">
		SELECT 
			  e.emp_no empNo
			, e.emp_name empName
			, (SELECT cd_nm FROM common_code WHERE crp_cd = 'E001' AND cd = e.emp_dept) empDept
			, (SELECT cd_nm FROM common_code WHERE crp_cd = 'E002' AND cd = e.emp_grade) empGrade
			, e.sign_file signFile
		FROM 
			employee e 
		INNER JOIN file_upload f 
			ON e.sign_file = f.file_no
		WHERE 
			e.emp_no = #{empNo}
	</select>
	
	
	<!-- 분류 번호: #11 - 전자결재 신청 페이지 :: 서명 파일 수정 -->
	<update id="updateApprovalSign" parameterType="String">
		UPDATE 
			employee e, file_upload f
		SET 
			  e.mod_time = NOW()
			, f.mod_time = NOW()
		WHERE 
			e.sign_file = f.file_no
		AND 
			e.emp_no = #{empNO}
	</update>
	
</mapper>